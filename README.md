# Multiplayer Game с системой комнат и лобби

Мультиплеерная игра на базе Phaser, Colyseus и Parcel с полноценной системой управления комнатами, лобби и системой готовности игроков.

## Функциональность

### Новые возможности v2.0
- **Система ников** - игроки вводят свой ник при запуске игры
- **Лобби комнат** - предыгровое лобби с отображением всех игроков
- **Система готовности** - каждый игрок может переключать статус готовности
- **Роли создателя** - создатель комнаты автоматически присоединяется как хост
- **Кнопка старта игры** - только создатель может начать игру когда все готовы
- **Визуальная индикация** - цветовое выделение создателя и текущего игрока
- **Передача роли** - при уходе создателя роль автоматически передается

### Базовые возможности v1.0
- **Интерфейс выбора комнат** - стартовое меню для управления комнатами
- **Создание комнат** - возможность создавать новые игровые комнаты с пользовательскими именами
- **Просмотр списка комнат** - отображение всех доступных комнат с информацией о количестве игроков
- **Подключение к комнатам** - выбор и присоединение к существующим комнатам
- **Мультиплеерное управление** - управление кораблем с помощью стрелок
- **Синхронизация состояния** - синхронизация между игроками в реальном времени

## Архитектура проекта

```
colyseus_demo/
├── server/                 # Серверная часть (Colyseus)
│   ├── src/
│   │   ├── app.config.ts   # Конфигурация сервера + API endpoints
│   │   ├── index.ts        # Точка входа сервера
│   │   └── rooms/
│   │       ├── MyRoom.ts   # Логика игровой комнаты с лобби
│   │       └── schema/
│   │           └── MyRoomState.ts  # Схема состояния (игроки, готовность, создатель)
│   └── package.json
└── client/                 # Клиентская часть (Phaser + Parcel)
    ├── index.html          # HTML страница
    ├── index.ts            # Главный файл клиента с 4 сценами
    └── package.json
```

## Сцены клиента

### 1. NicknameScene
Начальная сцена для ввода ника:
- Приветствие игрока
- Запрос ника через prompt
- Инициализация Colyseus клиента
- Автоматический переход к выбору комнат

### 2. RoomSelectionScene
Меню выбора комнат:
- Приветствие с отображением ника игрока
- Список всех доступных комнат
- Кнопки: "Create Room", "Refresh", "Join Room"
- Автоматическое присоединение создателя к созданной комнате

### 3. LobbyScene ⭐ НОВАЯ
Предыгровое лобби:
- Отображение всех подключенных игроков с никами
- Цветовая индикация ролей (создатель золотой, текущий игрок желтый)
- Кнопка готовности для каждого игрока
- Статус готовности: "READY" / "NOT READY"
- Кнопка "Start Game" только для создателя
- Автоматическая активация старта когда все готовы

### 4. GameScene
Игровая сцена:
- Управление кораблем стрелками (только после старта игры)
- Отображение ников над игроками
- Цветовое выделение текущего игрока
- Кнопка "Back to Lobby" для возврата

## API Endpoints

### GET /api/rooms
Получить список всех доступных комнат
```json
[
  {
    "roomId": "HSmasyi09",
    "name": "Test Lobby",
    "clients": 2,
    "maxClients": 4,
    "locked": false
  }
]
```

### POST /api/rooms
Создать новую комнату и автоматически присоединить создателя
```json
// Запрос
{
  "name": "My Room",
  "nickname": "PlayerName"
}

// Ответ
{
  "roomId": "HSmasyi09",
  "sessionId": "_bocLMjt4",
  "name": "My Room",
  "success": true
}
```

## Схема данных (Colyseus Schema)

### Player Schema
```typescript
@type("number") x: number;           // Позиция X
@type("number") y: number;           // Позиция Y
@type("string") nickname: string;    // Ник игрока
@type("boolean") ready: boolean;     // Статус готовности
```

### Room State Schema
```typescript
@type({ map: Player }) players;      // Карта всех игроков
@type("string") creatorId: string;   // ID создателя комнаты
@type("boolean") gameStarted: boolean; // Флаг начала игры
```

## Серверные сообщения

### Клиент → Сервер
- `"toggle-ready"` - переключить статус готовности
- `"start-game"` - начать игру (только создатель)
- `"move"` - движение игрока (только во время игры)

### Сервер → Клиент
- `"room-joined"` - информация о присоединении
- `"you-are-creator"` - уведомление о новой роли создателя
- `"all-players-ready"` - все игроки готовы
- `"game-started"` - игра началась

## Запуск проекта

### Сервер
```bash
cd server
npm install
npm start
```
Сервер запустится на http://localhost:2567

### Клиент
```bash
cd client
npm install
npm start
```
Клиент будет доступен на http://localhost:1234

## Как использовать

### Пошаговое руководство:

1. **Запустите сервер и клиент**
2. **Откройте http://localhost:1234 в браузере**
3. **Введите свой ник** в появившемся prompt
4. **В меню выбора комнат:**
   - Нажмите "Create Room" чтобы создать новую комнату (вы станете создателем)
   - Или выберите существующую комнату и нажмите "Join Room"
5. **В лобби:**
   - Дождитесь подключения других игроков
   - Нажмите "Ready" когда будете готовы
   - Создатель может нажать "Start Game" когда все игроки готовы
6. **В игре:**
   - Используйте стрелки для движения
   - Нажмите "Back to Lobby" для возврата в лобби

### Роли игроков:

- **Создатель комнаты (золотой фон):**
  - Автоматически присоединяется при создании
  - Может начинать игру кнопкой "Start Game"
  - При выходе роль передается следующему игроку

- **Обычный игрок (серый фон):**
  - Может переключать статус готовности
  - Ждет начала игры от создателя

- **Текущий игрок (желтый фон):**
  - Ваш собственный игрок в списке
  - Помечен как "(You)"

## Технические детали

### Сервер (Colyseus)
- Использует `matchMaker.create()` для создания комнат с резервацией
- Автоматическое назначение создателя (первый подключившийся)
- Система проверки готовности всех игроков
- Передача роли создателя при отключении
- Игровая логика активируется только после старта

### Клиент (Phaser)
- 4 сцены с переходами между ними
- Глобальное хранение ника и клиента Colyseus
- Реактивное обновление UI на изменения состояния
- Цветовая индикация ролей и статусов

### Особенности работы
- Ники сохраняются только в рамках сессии
- Создатель автоматически присоединяется к созданной комнате
- Игра начинается только когда все игроки готовы
- Возможность вернуться из игры в лобби
- Автоматическая передача роли создателя

## Мониторинг

Colyseus предоставляет встроенные инструменты:
- http://localhost:2567/monitor - панель мониторинга комнат
- http://localhost:2567/ - playground для тестирования

## Возможные улучшения

- **Система аккаунтов** - регистрация и авторизация
- **Настройки комнат** - лимиты игроков, пароли
- **Чат в лобби** - общение между игроками
- **Кастомизация** - выбор аватаров, цветов
- **Статистика** - учет побед, рейтинги
- **Спектаторы** - наблюдение за игрой
- **Более сложная игра** - цели, правила, геймплей 